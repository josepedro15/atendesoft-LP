{
  "name": "AtendeSoft Blog Engine - Sistema de Agentes N8N",
  "description": "Workflow automatizado para criação de posts de blog SEO-otimizados",
  "version": "1.0.0",
  "created_by": "AtendeSoft",
  "workflow": {
    "nodes": [
      {
        "name": "Schedule Trigger",
        "type": "n8n-nodes-base.scheduleTrigger",
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 15 * * *"
              }
            ]
          }
        },
        "description": "Executa diariamente às 15:00"
      },
      {
        "name": "Pesquisa Posts Antigos",
        "type": "n8n-nodes-base.googleSheets",
        "parameters": {
          "operation": "read",
          "documentId": "SEU_DOCUMENT_ID",
          "sheetName": "Sheet1"
        },
        "description": "Busca histórico de posts para evitar duplicação"
      },
      {
        "name": "Deduplicação",
        "type": "n8n-nodes-base.code",
        "parameters": {
          "jsCode": "// Remove termos já utilizados\nconst items = $input.all();\nconst normalize = (s) => (s ?? '').toString().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '').toLowerCase().replace(/\\s+/g, ' ').trim();\nconst qAll = [];\nfor (const it of items) {\n  if (it?.json?.q != null) qAll.push(String(it.json.q));\n}\nconst qNorm = qAll.map(normalize).filter(Boolean);\nconst qUnique = Array.from(new Set(qNorm));\nreturn [{ json: { q_unique: qUnique } }];"
        },
        "description": "Remove tópicos já utilizados"
      },
      {
        "name": "Gera Termo de Busca",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "parameters": {
          "promptType": "define",
          "text": "Você é estrategista de conteúdo da AtendeSoft. Gere APENAS UM termo de busca para o campo 'q' do Google Trends, alinhado aos eixos temáticos: IA, automações, chatbots e VENDAS NO WHATSAPP. Compare com o último termo usado e NÃO repita. O termo deve refletir claramente o universo de IA/automação/chatbots/vendas no WhatsApp. 2 palavras, minúsculas, sem acentos nem pontuação. Foco Brasil. Saída em pt-BR."
        },
        "description": "Gera termo único para Google Trends"
      },
      {
        "name": "Google Trends",
        "type": "n8n-nodes-base.httpRequest",
        "parameters": {
          "method": "GET",
          "url": "https://serpapi.com/search?engine=google_trends",
          "queryParameters": {
            "parameters": [
              {
                "name": "q",
                "value": "={{ $json.output }}"
              },
              {
                "name": "geo",
                "value": "BR"
              },
              {
                "name": "hl",
                "value": "pt-BR"
              },
              {
                "name": "data_type",
                "value": "RELATED_QUERIES"
              },
              {
                "name": "date",
                "value": "today 3-m"
              }
            ]
          }
        },
        "description": "Busca tendências no Google Trends"
      },
      {
        "name": "Filtra Tendências",
        "type": "n8n-nodes-base.code",
        "parameters": {
          "jsCode": "const top = ($node['Google Trends'].json?.related_queries?.top) ?? [];\nconst filtered = top.filter(it => Number(it?.extracted_value) > 30).map(it => ({\n  query: String(it?.query ?? '').trim(),\n  extracted_value: Number(it?.extracted_value ?? 0)\n}));\nreturn [{ json: { filtered, count: filtered.length } }];"
        },
        "description": "Filtra queries com volume > 30%"
      },
      {
        "name": "Escolha do Tópico",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "parameters": {
          "promptType": "define",
          "text": "Você faz parte de uma equipe que cria posts de blog de nível mundial. Sua tarefa é escolher o tema de cada post. Os posts são publicados no site da Atendesoft, uma plataforma de atendimento inteligente e automação que combina inteligência artificial, integrações WhatsApp/CRM/ERP e dashboards de análises em tempo real. Escolha APENAS UMA palavra-chave que será usada como tema do próximo post de blog. Priorize relevância para os produtos/mercado e use o valor (tendência) como critério de desempate. Escreva SOMENTE a palavra-chave escolhida, em texto simples, sem aspas, sem pontuação adicional e sem explicações."
        },
        "description": "Seleciona melhor tópico baseado em relevância SEO"
      },
      {
        "name": "Pesquisa Detalhada",
        "type": "n8n-nodes-base.httpRequest",
        "parameters": {
          "method": "POST",
          "url": "https://api.perplexity.ai/chat/completions",
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer SEU_TOKEN_PERPLEXITY"
              }
            ]
          },
          "jsonBody": "{\n  \"model\": \"sonar-pro\",\n  \"messages\": [\n    { \"role\": \"user\", \"content\": \"{{ $json.output }}\" }\n  ]\n}"
        },
        "description": "Pesquisa detalhada via Perplexity AI"
      },
      {
        "name": "Processa Fontes",
        "type": "n8n-nodes-base.set",
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "name": "research",
                "value": "={{ $json.choices[0].message.content.replaceAll('[1]', ' - source: ' +$json.citations[0]).replaceAll('[2]',' - source:' +$json.citations[1]).replaceAll('[3]',' - source: ' +$json.citations[2]).replaceAll('[4]',' - source: '+$json.citations[3]).replaceAll('[5]',' - source: '+$json.citations[4]) }}"
              }
            ]
          }
        },
        "description": "Processa citações e fontes"
      },
      {
        "name": "Cria Conteúdo",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "parameters": {
          "promptType": "define",
          "text": "You are part of a team that creates world class blog posts for SEO purposes. Every week your team posts one blog post on the most trending news in this week of AI. As the copywriter for the blogs, you are provided with the following information: Query: The topic of this weeks blog post. This is the most trending news in the space. Research findings: This is research found from very reputable resources in relation to the topic of the post. Your blog post must be based off this research. The blog post must: Place the query in the blog title, H1 header and early in the introduction. Include all detail in research findings. When including the research points, make sure to also include their source URL so that the copywriter can use them as hyperlinks. Be very detailed. Be using tone similar to that of a reporter, invoking curiosity and excitement and thrill in the readers. Flow naturally and make sense. Be at minimum 1500 to 2000 words long. Be suitable for a year 5 reading level. Make sure to create the entire blog post draft in your first output. Don't stop or cut it short. Your output must be the blog post and nothing else. IMPORTANT: Always write the entire blog post in Brazilian Portuguese. Do not use Spanish or English. Query: {{ $item('0').$node['Escolha do Tópico'].json['output'] }} Detailed Research: {{ $json.research }} Write the blog post."
        },
        "description": "Cria post completo (1500-2000 palavras)"
      },
      {
        "name": "Adiciona Links Internos",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "parameters": {
          "promptType": "define",
          "text": "You are part of a team that creates world class blog posts. You are in charge of internal linking between blog posts. For each new blog post that comes across your desk, your job is to look through previously posted blogs and make atleast 5 internal links. To choose the best internal linking opportunities you must: Read the previous blog post summaries and look through their keywords. If there is a match where the previous blog post is highly relevant, then this is an internal linking opportunity. Do not link if it is not highly relevant. Only make a link if it makes sense and adds value for the reader. Once you've found the best linking opportunities, you must update the blog post with the internal links. To do this you must: Add the link of the previous blog post at the relevant section of the new blog post. Drop the URL at the place which makes most sense. Later we will hyperlink the URL to the word in the blog post which it is placed next to. So your placing is very important. Make sure to not delete any existing URLs or change anything about the blog post provided to you. You must only add new internal linking URLs and output the revised blog post. Your output must be the blog post given to you plus the new urls. Don't remove any info. Don't return the previous blog posts. Only return the current blog post with the internal links added. Current blog Post: {{ $item('0').$node['Cria Conteúdo'].json['output'] }} Previous Blog Posts: {{ $json['previous-posts'].toJsonString().split() }}"
        },
        "description": "Adiciona 5+ links internos"
      },
      {
        "name": "Gera HTML",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "parameters": {
          "modelId": "gpt-4",
          "messages": {
            "values": [
              {
                "content": "DO NOT OUTPUT ANYTHING OTHER THAN THE CODE. I want you to follow the layout of the template as a guide to generate the HTML code for a blog post that matches the AtendeSoft website identity. The blog post should have a title, estimated reading time, key takeaways, table of contents, body, and FAQ in this order. Make it engaging by using italics, dot points, quotes, bold, spaces, and sometimes new lines. Never use emojis. Wrap the entire content in a container <div> with inline CSS that matches the AtendeSoft design system. Blog post: {{ $json.output }}"
              }
            ]
          }
        },
        "description": "Gera HTML com design AtendeSoft"
      },
      {
        "name": "Cria Slug",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "parameters": {
          "promptType": "define",
          "text": "Create a slug for the following blog post: {{ $item('0').$node['Adiciona Links Internos'].json['output'] }} A slug in a blog post is the part of the URL that comes after the domain name and identifies a specific page. It is typically a short, descriptive phrase that summarizes the content of the post, making it easier for users and search engines to understand what the page is about. The slug must be 4 or 5 words max and must include the primary keyword of the blog post. Your output must be the slug and nothing else so that I can copy and paste your output and put it at the end of my blog post URL to post it right away."
        },
        "description": "Cria URL otimizada (4-5 palavras)"
      },
      {
        "name": "Extrai Título",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "parameters": {
          "promptType": "define",
          "text": "Extract the blog post title from the following blog post: {{ $item('0').$node['Adiciona Links Internos'].json['output'] }} The blog post title must include the primary keyword and must inform the users right away of what they can expect from reading the blog post. Don't put the output in quotes. The output should just text with no markdown or formatting. Your output must only be the blog post title and nothing else."
        },
        "description": "Extrai título SEO-friendly"
      },
      {
        "name": "Cria Meta Description",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "parameters": {
          "promptType": "define",
          "text": "Create a good meta description for the following blog post: {{ $item('0').$node['Adiciona Links Internos'].json['output'] }} A good meta description for a blog post that is SEO-optimized should: Be Concise: Stick to 150-160 characters to ensure the full description displays in search results. Include Keywords: Incorporate primary keywords naturally to improve visibility and relevance to search queries. Provide Value: Clearly describe what the reader will learn or gain by clicking the link. Be Engaging: Use persuasive language, such as action verbs or a question, to encourage clicks. Align with Content: Ensure the description accurately reflects the blog post to meet user expectations and reduce bounce rates. Your output must only be the meta description and nothing else."
        },
        "description": "Cria meta description (150-160 caracteres)"
      },
      {
        "name": "Busca Imagem",
        "type": "n8n-nodes-base.httpRequest",
        "parameters": {
          "method": "GET",
          "url": "https://serpapi.com/search?engine=google_images",
          "queryParameters": {
            "parameters": [
              {
                "name": "q",
                "value": "={{ $item('0').$node['Escolha do Tópico'].json['output'] }}"
              },
              {
                "name": "gl",
                "value": "us"
              }
            ]
          }
        },
        "description": "Busca imagem de capa"
      },
      {
        "name": "Processa Imagem",
        "type": "n8n-nodes-base.set",
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "name": "image-url",
                "value": "={{ $json.images_results[1].original }}"
              }
            ]
          }
        },
        "description": "Processa URL da imagem"
      },
      {
        "name": "Salva no Supabase",
        "type": "n8n-nodes-base.supabase",
        "parameters": {
          "operation": "insert",
          "tableId": "blog_posts",
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "timestamp",
                "fieldValue": "={{ $item('0').$node['Schedule Trigger'].json['timestamp'] }}"
              },
              {
                "fieldId": "title",
                "fieldValue": "={{ $item('0').$node['Extrai Título'].json['output'] }}"
              },
              {
                "fieldId": "keyword",
                "fieldValue": "={{ $item('0').$node['Escolha do Tópico'].json['output'] }}"
              },
              {
                "fieldId": "summary",
                "fieldValue": "={{ $item('0').$node['Cria Meta Description'].json['output'] }}"
              },
              {
                "fieldId": "url",
                "fieldValue": "={{ $item('0').$node['Cria Slug'].json['output'] }}"
              },
              {
                "fieldId": "image",
                "fieldValue": "={{ $item('0').$node['Processa Imagem'].json['image-url'] }}"
              },
              {
                "fieldId": "content",
                "fieldValue": "={{ $item('0').$node['Gera HTML'].json['message']['content'] }}"
              },
              {
                "fieldId": "status",
                "fieldValue": "published"
              }
            ]
          }
        },
        "description": "Publica no banco de dados"
      },
      {
        "name": "Notifica WhatsApp",
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "parameters": {
          "resource": "messages-api",
          "instanceName": "multiagent",
          "remoteJid": "5531994959512@s.whatsapp.net",
          "messageText": "={{ $item('0').$node['Cria Conteúdo'].json['output'] }}"
        },
        "description": "Envia notificação via WhatsApp"
      }
    ],
    "connections": {
      "Schedule Trigger": {
        "main": [["Pesquisa Posts Antigos"]]
      },
      "Pesquisa Posts Antigos": {
        "main": [["Deduplicação"]]
      },
      "Deduplicação": {
        "main": [["Gera Termo de Busca"]]
      },
      "Gera Termo de Busca": {
        "main": [["Google Trends"]]
      },
      "Google Trends": {
        "main": [["Filtra Tendências"]]
      },
      "Filtra Tendências": {
        "main": [["Escolha do Tópico"]]
      },
      "Escolha do Tópico": {
        "main": [["Pesquisa Detalhada"]]
      },
      "Pesquisa Detalhada": {
        "main": [["Processa Fontes"]]
      },
      "Processa Fontes": {
        "main": [["Cria Conteúdo"]]
      },
      "Cria Conteúdo": {
        "main": [["Adiciona Links Internos"]]
      },
      "Adiciona Links Internos": {
        "main": [["Gera HTML"]]
      },
      "Gera HTML": {
        "main": [["Cria Slug"]]
      },
      "Cria Slug": {
        "main": [["Extrai Título"]]
      },
      "Extrai Título": {
        "main": [["Cria Meta Description"]]
      },
      "Cria Meta Description": {
        "main": [["Busca Imagem"]]
      },
      "Busca Imagem": {
        "main": [["Processa Imagem"]]
      },
      "Processa Imagem": {
        "main": [["Salva no Supabase"]]
      },
      "Salva no Supabase": {
        "main": [["Notifica WhatsApp"]]
      }
    }
  },
  "instructions": {
    "setup": [
      "1. Configure as credenciais das APIs (OpenAI, Perplexity, SerpAPI, Supabase, Evolution API)",
      "2. Atualize o documentId do Google Sheets com seus posts anteriores",
      "3. Configure o número do WhatsApp para notificações",
      "4. Teste o workflow com execução manual antes de ativar o agendamento"
    ],
    "customization": [
      "1. Ajuste o horário de execução no Schedule Trigger",
      "2. Modifique os prompts dos agentes de IA conforme necessário",
      "3. Configure filtros de tendências (atualmente > 30%)",
      "4. Personalize o template HTML para seu design"
    ],
    "monitoring": [
      "1. Monitore logs de execução no N8N",
      "2. Verifique posts criados no Supabase",
      "3. Confirme notificações no WhatsApp",
      "4. Acompanhe métricas de SEO dos posts"
    ]
  },
  "requirements": {
    "apis": [
      "OpenAI API (GPT-4)",
      "Perplexity AI API",
      "SerpAPI (Google Trends + Images)",
      "Supabase API",
      "Evolution API (WhatsApp)",
      "Google Sheets API"
    ],
    "n8n_version": "1.0.0+",
    "estimated_cost": "~$50-100/mês (dependendo do volume)"
  }
}
